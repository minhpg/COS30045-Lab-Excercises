<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Data Visualisation Exercise 5.2" />
    <meta name="keywords" content="HTML CSS JS" />
    <meta name="author" content="Gia Minh Pham - 103808249" />

    <title>Task 5.2 D3 Transitions</title>

    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

    <style></style>
  </head>

  <body class="container mx-auto py-6 flex flex-col items-center h-screen">
    <main class="prose flex-1">
      <h1>D3 Transitions</h1>
      <figure id="bar-chart"></figure>
      <div class="flex flex-col gap-2">
        <div class="flex gap-2 w-full">
          <div
            class="flex items-center gap-3 bg-white border border-gray-200 text-black text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-3 py-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-6 h-6 text-gray-500"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456ZM16.894 20.567 16.5 21.75l-.394-1.183a2.25 2.25 0 0 0-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 0 0 1.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 0 0 1.423 1.423l1.183.394-1.183.394a2.25 2.25 0 0 0-1.423 1.423Z"
              />
            </svg>
            <select
              id="select-transition-animation"
              class="p-0 border-transparent focus:border-transparent focus:ring-0 w-full outline-none text-sm"
            >
              <option disabled class="text-gray-500">
                Select an ease animation
              </option>
            </select>
          </div>
          <div
            class="flex items-center gap-3 bg-white border border-gray-200 text-black text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full px-3 py-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-6 h-6 text-gray-500"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
              />
            </svg>
            <input
              placeholder="Duration (ms)"
              type="number"
              class="text-black text-sm p-0 border-transparent focus:border-transparent focus:ring-0 w-full outline-none"
              id="input-transition-duration"
            />
          </div>
        </div>
        <button
          id="btn-update-graph"
          class="bg-blue-500 rounded-lg text-white px-3 py-2 text-sm"
        >
          Update data
        </button>
      </div>
    </main>

    <footer class="font-black p-6 text-center">
      <div class="font-light">Gia Minh Pham - 103808249</div>
      <div>COS30045 Data Visualisation</div>
    </footer>

    <script>
      /** Graph configs */
      const width = document.getElementById("bar-chart").offsetWidth;
      const height = 500;
      const margin = 0;
      const maxValue = 25;
      const maxLength = 25;
      const padding = (width / maxLength) * 0.05;
      const ticks = 5;

      /** Default transition settings */
      let transitionDuration = 3000;
      let transitionEase = "easeElastic";

      /** Generate random dataset*/
      const generateDataset = () => {
        /** Create array with length */
        return (
          Array(maxLength)
            /** Temporary fill with 0s */
            .fill(0)
            /** Map to random function */
            .map(
              () => Math.ceil(Math.random() * maxValue) // Math.random*value => creates value between 0-maxValue
            )
        );
      };

      /** Declare D3 ease values */
      const d3Eases = [
        {
          name: "easeLinear",
          d3Ease: d3.easeLinear,
        },
        {
          name: "easeQuad",
          d3Ease: d3.easeQuad,
        },
        {
          name: "easeCubic",
          d3Ease: d3.easeCubic,
        },
        {
          name: "easePoly",
          d3Ease: d3.easePoly,
        },
        {
          name: "easeSin",
          d3Ease: d3.easeSin,
        },
        {
          name: "easeExp",
          d3Ease: d3.easeExp,
        },
        {
          name: "easeCircle",
          d3Ease: d3.easeCircle,
        },
        {
          name: "easeBounce",
          d3Ease: d3.easeBounce,
        },
        {
          name: "easeBack",
          d3Ease: d3.easeBack,
        },
        {
          name: "easeElastic",
          d3Ease: d3.easeElastic,
        },
      ];

      /** Initialize dataset */
      let dataset = generateDataset();

      /** Calculate width & height with margin */

      const innerWidth = width - margin * 2;
      const innerHeight = height - margin * 2;

      /** Initialize x/y scales */
      const xScale = d3
        .scaleBand()
        .domain(d3.range(dataset.length))
        .range([0, innerWidth]);

      const yScale = d3
        .scaleLinear()
        .domain([0, d3.max(dataset)])
        .range([0, innerHeight]);

      /** Create SVG DOM object */
      const svg = d3
        .select("#bar-chart")
        .append("svg")
        .attr("width", width)
        .attr("height", height)
        .append("g");

      /** Draw bars */
      svg
        .selectAll("rect")
        .data(dataset)
        .enter()
        .append("rect")
        .attr("x", (_, index) => index * xScale.bandwidth() + padding)
        .attr("width", xScale.bandwidth() - padding)
        .attr("y", (data) => innerHeight - yScale(data))
        .attr("height", (data) => yScale(data));

      /** Create caption */
      d3.select("#bar-chart")
        .append("figcaption")
        .text("Figure 1. Test bar chart data binding with SVG");

      /** Create ease select options from ease array */
      d3.select("#select-transition-animation")
        .selectAll("option")
        .data(d3Eases)
        .enter()
        .append("option")
        .attr("value", (d) => d.name)
        .attr("selected", (d) => d.name === transitionEase)
        .text((d) => d.name);

      /** Assign default input values */
      d3.select("#input-transition-duration").attr("value", transitionDuration);

      /** Update graph function */
      const updateGraph = ({ dataset }) => {
        /** Draw bars */
        svg
          .selectAll("rect")
          .data(dataset)
          .transition()
          .delay((_, index) => (index / dataset.length) * transitionDuration) // Staggered delay
          .duration(transitionDuration)
          .ease(
            d3Eases.find(
              (d) => d.name === transitionEase // Find ease by name
            ).d3Ease
          )
          .attr("x", (_, index) => index * xScale.bandwidth() + padding)
          .attr("width", xScale.bandwidth() - padding)
          .attr("y", (data) => innerHeight - yScale(data))
          .attr("height", (data) => yScale(data));
      };

      /** Update Data button event listener */
      d3.select("#btn-update-graph").on("click", () => {
        /** Generate new dataset */
        dataset = generateDataset();
        updateGraph({ dataset });
      });

      /** Transition ease select event listeners */
      d3.select("#select-transition-animation").on("change", (event) => {
        /** Assign new ease */
        transitionEase = event.target.value;
      });

      /** Transition duration input event listeners */
      d3.select("#input-transition-duration").on("input", (event) => {
        /** Assign new duration */
        transitionDuration = event.target.value;
      });
    </script>
  </body>
</html>
